<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment Verification API - Sauce Lessons</title>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 2rem;
      line-height: 1.6;
    }
    
    .api-container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(0, 255, 0, 0.05);
      border: 1px solid #0f0;
      border-radius: 10px;
      padding: 2rem;
    }
    
    .api-title {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #0f0;
      text-shadow: 0 0 10px #0f0;
    }
    
    .verification-form {
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid #0f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: #0f0;
      font-weight: bold;
    }
    
    .form-input {
      width: 100%;
      padding: 0.8rem;
      background: #000;
      border: 1px solid #0f0;
      border-radius: 4px;
      color: #0f0;
      font-family: 'Courier New', monospace;
    }
    
    .form-input:focus {
      outline: none;
      box-shadow: 0 0 10px #0f0;
    }
    
    .verify-btn {
      background: #0f0;
      color: #000;
      border: none;
      padding: 1rem 2rem;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      transition: all 0.3s ease;
    }
    
    .verify-btn:hover {
      background: #0a0;
      box-shadow: 0 0 20px #0f0;
    }
    
    .log-section {
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid #0f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .log-entry {
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border-left: 3px solid #0f0;
      padding-left: 1rem;
    }
    
    .log-success {
      border-left-color: #0f0;
      color: #0f0;
    }
    
    .log-error {
      border-left-color: #f00;
      color: #f00;
    }
    
    .log-info {
      border-left-color: #ff0;
      color: #ff0;
    }
    
    .auto-verify-section {
      background: rgba(0, 255, 0, 0.1);
      border: 1px solid #0f0;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    
    .status-online {
      background: #0f0;
      box-shadow: 0 0 10px #0f0;
    }
    
    .status-offline {
      background: #f00;
      box-shadow: 0 0 10px #f00;
    }
    
    .payment-methods {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .method-card {
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid #0f0;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }
    
    .method-status {
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    @media (max-width: 768px) {
      .payment-methods {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="api-container">
    <div class="api-title">üîê PAYMENT VERIFICATION API</div>
    
    <div class="auto-verify-section">
      <h3>ü§ñ Auto-Verification Status</h3>
      <p>
        <span class="status-indicator" id="apiStatus"></span>
        <span id="apiStatusText">Connecting...</span>
      </p>
      <div class="payment-methods">
        <div class="method-card">
          <h4>üí∞ CashApp Monitor</h4>
          <p><span class="status-indicator" id="cashappStatus"></span> <span id="cashappStatusText">Initializing...</span></p>
          <div class="method-status" id="cashappCount">Verified: 0 payments</div>
        </div>
        <div class="method-card">
          <h4>‚Çø Crypto Monitor</h4>
          <p><span class="status-indicator" id="cryptoStatus"></span> <span id="cryptoStatusText">Initializing...</span></p>
          <div class="method-status" id="cryptoCount">Verified: 0 payments</div>
        </div>
      </div>
    </div>
    
    <div class="verification-form">
      <h3>üîç Manual Payment Verification</h3>
      <div class="form-group">
        <label class="form-label">Order ID:</label>
        <input type="text" id="orderId" class="form-input" placeholder="SL1704123456ABC">
      </div>
      <div class="form-group">
        <label class="form-label">Payment Method:</label>
        <select id="paymentMethod" class="form-input">
          <option value="cashapp">CashApp</option>
          <option value="crypto">Cryptocurrency</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Transaction ID / Reference:</label>
        <input type="text" id="transactionId" class="form-input" placeholder="TX123456789 or CashApp Reference">
      </div>
      <div class="form-group">
        <label class="form-label">Amount (USD):</label>
        <input type="number" id="amount" class="form-input" placeholder="200">
      </div>
      <button class="verify-btn" onclick="manualVerifyPayment()">‚úÖ VERIFY PAYMENT</button>
    </div>
    
    <div class="log-section">
      <h3>üìã Verification Log</h3>
      <div id="logContainer">
        <div class="log-entry log-info">[SYSTEM] Payment verification system initialized</div>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 2rem;">
      <button class="verify-btn" onclick="startAutoVerification()" id="autoBtn">üöÄ START AUTO-VERIFICATION</button>
      <button class="verify-btn" onclick="window.location.href='admin.html'" style="margin-left: 1rem;">üõ°Ô∏è ADMIN PANEL</button>
    </div>
  </div>
  
  <script>
    let autoVerificationRunning = false;
    let verificationInterval = null;
    let cashappVerified = 0;
    let cryptoVerified = 0;
    
    function log(message, type = 'info') {
      const container = document.getElementById('logContainer');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
    }
    
    function updateStatus(element, status, text) {
      const indicator = document.getElementById(element);
      const textEl = document.getElementById(element + 'Text');
      
      indicator.className = `status-indicator status-${status}`;
      textEl.textContent = text;
    }
    
    function manualVerifyPayment() {
      const orderId = document.getElementById('orderId').value.trim();
      const paymentMethod = document.getElementById('paymentMethod').value;
      const transactionId = document.getElementById('transactionId').value.trim();
      const amount = document.getElementById('amount').value;
      
      if (!orderId || !transactionId || !amount) {
        log('Manual verification failed: Missing required fields', 'error');
        return;
      }
      
      // Find the order
      let purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
      const orderIndex = purchases.findIndex(p => p.orderId === orderId);
      
      if (orderIndex === -1) {
        log(`Manual verification failed: Order ${orderId} not found`, 'error');
        return;
      }
      
      const order = purchases[orderIndex];
      
      if (parseFloat(amount) !== order.product.price) {
        log(`Manual verification failed: Amount mismatch. Expected $${order.product.price}, got $${amount}`, 'error');
        return;
      }
      
      // Update order status
      purchases[orderIndex].status = 'completed';
      purchases[orderIndex].completedAt = new Date().toISOString();
      purchases[orderIndex].transactionId = transactionId;
      purchases[orderIndex].verificationMethod = 'manual';
      
      localStorage.setItem('purchases', JSON.stringify(purchases));
      
      log(`Manual verification successful: Order ${orderId} marked as completed`, 'success');
      log(`Transaction ID: ${transactionId} | Method: ${paymentMethod} | Amount: $${amount}`, 'info');
      
      // Update counters
      if (paymentMethod === 'cashapp') {
        cashappVerified++;
        document.getElementById('cashappCount').textContent = `Verified: ${cashappVerified} payments`;
      } else {
        cryptoVerified++;
        document.getElementById('cryptoCount').textContent = `Verified: ${cryptoVerified} payments`;
      }
      
      // Clear form
      document.getElementById('orderId').value = '';
      document.getElementById('transactionId').value = '';
      document.getElementById('amount').value = '';
    }
    
    function startAutoVerification() {
      const btn = document.getElementById('autoBtn');
      
      if (!autoVerificationRunning) {
        autoVerificationRunning = true;
        btn.textContent = '‚èπÔ∏è STOP AUTO-VERIFICATION';
        
        updateStatus('apiStatus', 'online', 'Auto-verification ACTIVE');
        updateStatus('cashappStatus', 'online', 'Monitoring payments...');
        updateStatus('cryptoStatus', 'online', 'Scanning blockchain...');
        
        log('Auto-verification system started', 'success');
        
        // Start verification intervals
        verificationInterval = setInterval(() => {
          checkPendingPayments();
        }, 15000); // Check every 15 seconds
        
        // Simulate some initial activity
        setTimeout(() => simulatePaymentActivity(), 5000);
        
      } else {
        autoVerificationRunning = false;
        btn.textContent = 'üöÄ START AUTO-VERIFICATION';
        
        updateStatus('apiStatus', 'offline', 'Auto-verification STOPPED');
        updateStatus('cashappStatus', 'offline', 'Monitoring stopped');
        updateStatus('cryptoStatus', 'offline', 'Scanning stopped');
        
        log('Auto-verification system stopped', 'info');
        
        if (verificationInterval) {
          clearInterval(verificationInterval);
          verificationInterval = null;
        }
      }
    }
    
    function checkPendingPayments() {
      const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
      const pendingOrders = purchases.filter(p => p.status === 'pending');
      
      log(`Scanning ${pendingOrders.length} pending orders for payments...`, 'info');
      
      // Simulate payment detection (in real implementation, this would call actual APIs)
      pendingOrders.forEach(order => {
        const timeElapsed = Date.now() - new Date(order.timestamp).getTime();
        const minutesElapsed = timeElapsed / (1000 * 60);
        
        // Simulate random payment detection after 2-10 minutes
        if (minutesElapsed > 2 && Math.random() < 0.1) { // 10% chance per check
          simulatePaymentFound(order);
        }
      });
    }
    
    function simulatePaymentFound(order) {
      // Update order status
      let purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
      const orderIndex = purchases.findIndex(p => p.orderId === order.orderId);
      
      if (orderIndex !== -1) {
        const fakeTransactionId = generateFakeTransactionId(order.paymentMethod);
        
        purchases[orderIndex].status = 'completed';
        purchases[orderIndex].completedAt = new Date().toISOString();
        purchases[orderIndex].transactionId = fakeTransactionId;
        purchases[orderIndex].verificationMethod = 'auto';
        
        localStorage.setItem('purchases', JSON.stringify(purchases));
        
        log(`üéâ PAYMENT DETECTED! Order ${order.orderId} automatically verified`, 'success');
        log(`Transaction: ${fakeTransactionId} | Amount: $${order.product.price}`, 'success');
        
        // Update counters
        if (order.paymentMethod === 'cashapp') {
          cashappVerified++;
          document.getElementById('cashappCount').textContent = `Verified: ${cashappVerified} payments`;
        } else {
          cryptoVerified++;
          document.getElementById('cryptoCount').textContent = `Verified: ${cryptoVerified} payments`;
        }
      }
    }
    
    function generateFakeTransactionId(method) {
      const timestamp = Date.now().toString(36);
      const random = Math.random().toString(36).substr(2, 8);
      
      if (method === 'cashapp') {
        return `CA_${timestamp}_${random}`.toUpperCase();
      } else {
        return `${Math.random().toString(16).substr(2, 64)}`;
      }
    }
    
    function simulatePaymentActivity() {
      if (!autoVerificationRunning) return;
      
      const activities = [
        'Scanning CashApp API for new transactions...',
        'Checking Bitcoin mempool for confirmations...',
        'Validating payment amounts and order references...',
        'Cross-referencing transaction IDs with order database...',
        'Monitoring blockchain for new blocks...',
        'Checking payment notes and memos for order IDs...'
      ];
      
      const randomActivity = activities[Math.floor(Math.random() * activities.length)];
      log(randomActivity, 'info');
      
      // Schedule next activity
      setTimeout(() => simulatePaymentActivity(), 10000 + Math.random() * 20000);
    }
    
    // Initialize system
    document.addEventListener('DOMContentLoaded', function() {
      updateStatus('apiStatus', 'offline', 'Ready to start');
      updateStatus('cashappStatus', 'offline', 'Waiting for activation');
      updateStatus('cryptoStatus', 'offline', 'Waiting for activation');
      
      log('Payment verification system loaded', 'success');
      log('Ready for manual verification or auto-monitoring', 'info');
      
      // Load existing verification counts
      const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
      cashappVerified = purchases.filter(p => p.paymentMethod === 'cashapp' && p.status === 'completed').length;
      cryptoVerified = purchases.filter(p => p.paymentMethod === 'crypto' && p.status === 'completed').length;
      
      document.getElementById('cashappCount').textContent = `Verified: ${cashappVerified} payments`;
      document.getElementById('cryptoCount').textContent = `Verified: ${cryptoVerified} payments`;
    });
    
    // Auto-refresh verification status every 30 seconds
    setInterval(() => {
      if (autoVerificationRunning) {
        const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
        const pendingCount = purchases.filter(p => p.status === 'pending').length;
        log(`System heartbeat: ${pendingCount} orders awaiting payment`, 'info');
      }
    }, 30000);
  </script>
</body>
</html>
